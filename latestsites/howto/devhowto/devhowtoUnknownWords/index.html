<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>DELPH-IN How-To</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="DELPH-IN How-To">
<meta property="og:title" content="DELPH-IN How-To">
<meta property="og:url" content="http://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoUnknownWords/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoUnknownWords/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/docsproto/howto/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/docsproto/howto/feed.xml" type="application/atom+xml" rel="alternate" title="DELPH-IN How-To Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/docsproto/howto/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/docsproto/howto/"><img src="/docsproto/howto/assets/images/Delph-In.png" alt="DELPH-IN How-To"></a>
        
        <a class="site-title" href="/docsproto/howto/">
          DELPH-IN How-To
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/home/Home">Home</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/howto/DelphinWelcome">How-To</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/erg/ErgTop">ERG</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/tools/ToolsTop">Tools</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/grammars/NorsourceTop">Grammars</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/matrix/MatrixTop">Matrix</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/summits/SummitTop">Summits</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/garage/AgreeTop">Garage</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/missing/AclAnthologyCorpus">Missing</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">DELPH-IN</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/DelphinWelcome/">Welcome</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoOverview/">Overview</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoMRS/">Minimal Recursion Semantics</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoWellFormedTree/">Well-Formed Trees</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPredicationContract/">The Predication Contract</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPyhonBasics/">Python Primer and State</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoImplementPredication/">Implementing a Predication</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoMRSToPython/">MRS To Python</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoConjunctions/">Conjunctions</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoScopalArguments/">Scopal Arguments</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoEvents/">Event Variables</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSentenceForce/">Sentence Force</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimplePropositions/">Simple Propositions</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimpleQuestions/">Simple Questions</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimpleCommands/">Simple Commands</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoChoosingWhichFailure/">Reporting the Right Failure</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoReportingAFailure/">A Naive Failure</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoConceptualFailures/">Converting Variables to English</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoRobustFailure/">A More Robust Failure</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoQuantifierErrors/">Quantifier Errors</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoFinishingErrors/">Adding Errors to Every Predication</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoErrorScenarios/">Error Scenarios Summary</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoGenerateMRSAndTrees/">Phrases to MRS and Trees</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoWhichParseAndTree/">Choosing the 'Right' Tree</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoUnknownWords/" class="active">Unknown Words and Synonyms</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPredicationArgumentsAndUsage/">Predication Signatures and Usage</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPythonDecorators/">A. Python Decorators</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoParsePredication/">B. Parsing Predications</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Grammarian Tutorial</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/DelphinTutorial/">Overview</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Formalisms/">Formalisms</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Grammars/">Grammars</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Processing/">Processing</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Distributions/">Distributions</a></li>
          
            <li><a href="/docsproto/howto/HpsgTutorial/">HPSG</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Other Tutorials</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/SaarlandAceAgree/">Ace/Agree Tutorial (2013)</a></li>
          
            <li><a href="/docsproto/howto/ErsTutorial/">English Resource Semantics Tutorial (NAACL 2016)</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="handling-unknown-words-and-synonyms">Handling Unknown Words and Synonyms</h2>
<p>Now that we have a nice interactive system, it is easy to encounter words that aren’t implemented. The default behavior isn’t good if the user types one in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? there is a file
Traceback (most recent call last):
  File "/Users/ericzinda/Enlistments/Perplexity/file_system_example/examples.py", line 346, in &lt;module&gt;
    Example16()
  File "/Users/ericzinda/Enlistments/Perplexity/file_system_example/examples.py", line 305, in Example16
    user_interface.interact_once(respond_to_mrs_tree)
    
    ...
    
  File "/Users/ericzinda/Enlistments/Perplexity/perplexity/execution.py", line 87, in _call_predication
    module = sys.modules[module_function[0]]
TypeError: 'NoneType' object is not subscriptable

Process finished with exit code 1
</code></pre></div></div>
<p>Instead of crashing, we should be reporting a nice error. Adding a small amount of code to _<code class="language-plaintext highlighter-rouge">call_predication()</code> to report an error when there is not an implementation of a predication is one approach:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def _call_predication(self, state, predication):
        
        ...
        
        # Look up the actual Python module and
        # function name given a string like "folder_n_of".
        # "vocabulary.Predication" returns a two-item list,
        # where item[0] is the module and item[1] is the function
        module_function = self.vocabulary.predication(predication_name)
        
        # If there is not an implementation of the predication, report an error
        if module_function is None:
            self.report_error(["termNotUnderstood", predication_name])
            return
</code></pre></div></div>

<p>The problem with this approach is that it will only report the first word that wasn’t understood since the error stops the execution of the tree. Also, since it is using the normal error reporting system that predications use, the error can be caught and ignored. This is exactly what would happen if we implement that code and then run “there is a bird” through the system, you get:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? there is a bird
There isn't 'a bird' in the system
</code></pre></div></div>

<p>The real error is “I don’t know the words ‘be’ and ‘bird’”, but our quantifiers have the following logic in them (from the <a href="https://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoQuantifierErrors">Quantifier Errors topic</a>) and so the error is ignored:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def a_q(state, x_variable, h_rstr, h_body):
    
    ...

    if not rstr_found:
        # Ignore whatever error the RSTR produced, this is a better one
        # Report the variable's English representation as it would be in the BODY
        report_error(["doesntExist", ["AtPredication", h_body, x_variable]], force=True)
</code></pre></div></div>

<p>A better approach all around is to add an earlier stage to our processing pipeline: Before we bother to <a href="https://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoWellFormedTree">build a well-formed tree</a> (because it could take some time), check and see if we understand all the terms. If not, building the tree won’t help anyway.  In addition, this gives us a chance to do some swapping out of terms for synonyms if we so choose.</p>

<p>So, first let’s build a function that goes through all the predications in an MRS and returns any that are not known by the system:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def unknown_words(self, mrs):
        unknown_words = []
        for predication in mrs.predications:
            if self.execution_context.vocabulary.predication(predication.predicate) is None:
                # This predication is not implemented
                unknown_words.append(predication.predicate)

        return unknown_words
</code></pre></div></div>

<p>Now we can check if there are unknown words before we do the processing, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class UserInterface(object):
    
    ...
    
    # response_function gets passed three arguments:
    #   response_function(mrs, solutions, error)
    # It must use them to return a string to say to the user
    def interact_once(self, response_function):
        # input() pauses the program and waits for the user to
        # type input and hit enter, and then returns it
        user_input = str(input("? "))
        best_failure = None

        # Loop through each MRS and each tree that can be
        # generated from it...
        for mrs in self.mrss_from_phrase(user_input):
            unknown_words = self.unknown_words(mrs)
            if len(unknown_words) &gt; 0:
                if best_failure is None:
                    best_failure = response_function(None, [], [0, ["unknownWords", unknown_words]])

                continue

            for tree in self.trees_from_mrs(mrs):
                
                ...
</code></pre></div></div>

<p>And, for good measure, we’ll add in support for synonyms to the <code class="language-plaintext highlighter-rouge">Predication</code> decorator and the <code class="language-plaintext highlighter-rouge">Vocabulary</code> class:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
def Predication(vocabulary, name=None, synonyms=[]):
    ...
    
        vocabulary.add_predication(function_to_decorate.__module__, function_to_decorate.__name__, predication_name, synonyms)

    ...
    
    
class Vocabulary(object):
    def __init__(self):
        self.all = dict()

    def add_predication(self, module, function, delphin_name, synonyms):
        self.all[delphin_name] = [module, function]
        for synonym in synonyms:
            self.all[synonym] = [module, function]
    
    ...
</code></pre></div></div>

<p>Now if we run the sample interactively (with logging turned on) and use words that aren’t known, we get a decent response:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def Example16():
    state = State([Actor(name="Computer", person=2),
                   Folder(name="Desktop"),
                   Folder(name="Documents"),
                   File(name="file1.txt", size=2000000)])

    user_interface = UserInterface(state, vocabulary)

    while True:
        user_interface.interact_once(respond_to_mrs_tree)
        print()
                    
# Running Example16() results in:
? erase a file
Pipeline 2023-01-09 14:10:46,870: 2 parse options for erase a file
Pipeline 2023-01-09 14:10:46,878: Parse 0: &lt;MRS object (pronoun_q pron _erase_v_1 _a_q _file_n_of) at 140409290505904&gt;
Pipeline 2023-01-09 14:10:46,879: Parse 1: &lt;MRS object (_erase_v_1 _a_q _file_n_of) at 140409290505008&gt;
I don't know the words: erase
</code></pre></div></div>

<p>Much better! Now we can also easily add <code class="language-plaintext highlighter-rouge">erase</code> as a synonym of <code class="language-plaintext highlighter-rouge">delete</code> by looking at the emitted logs to see what the predication name was (<code class="language-plaintext highlighter-rouge">_erase_v_1</code>) and including it as a <code class="language-plaintext highlighter-rouge">synonym</code> argument of the <code class="language-plaintext highlighter-rouge">Predication</code> decorator for <code class="language-plaintext highlighter-rouge">delete_v_1</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, name="_delete_v_1", synonyms=["_erase_v_1"])
def delete_v_1(state, e_introduced, x_actor, x_what):
    ...
    
# Running Example16() results in:
? erase a file
Done!  
</code></pre></div></div>

<p>Great! But what if the user types something like “a file is deleted”?</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? a file is deleted
Traceback (most recent call last):
  File "/Users/ericzinda/Enlistments/Perplexity/file_system_example/examples.py", line 348, in &lt;module&gt;
    Example16()
  File "/Users/ericzinda/Enlistments/Perplexity/file_system_example/examples.py", line 307, in Example16
    user_interface.interact_once(respond_to_mrs_tree)
  File "/Users/ericzinda/Enlistments/Perplexity/perplexity/user_interface.py", line 45, in interact_once
    for item in self.execution_context.solve_mrs_tree(self.state, tree_info):
    
    ...
    
</code></pre></div></div>

<p>The <a href="https://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoPredicationArgumentsAndUsage">next section</a> will explore what is going on here and how we can fix it.</p>

<blockquote>
  <p>Comprehensive source for the completed tutorial is available <a href="https://github.com/EricZinda/Perplexity">here</a>.</p>
</blockquote>

<update date="" omitted="" for="" speed="">
</update>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/docsproto/howto/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/docsproto/howto/assets/js/main.min.js"></script>




<script src="/docsproto/howto/assets/js/lunr/lunr.min.js"></script>
<script src="/docsproto/howto/assets/js/lunr/lunr-store.js"></script>
<script src="/docsproto/howto/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
