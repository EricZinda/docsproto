<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>DELPH-IN How-To</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="DELPH-IN How-To">
<meta property="og:title" content="DELPH-IN How-To">
<meta property="og:url" content="http://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoQuantifierErrors/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/docsproto/howto/devhowto/devhowtoQuantifierErrors/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/docsproto/howto/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/docsproto/howto/feed.xml" type="application/atom+xml" rel="alternate" title="DELPH-IN How-To Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/docsproto/howto/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/docsproto/howto/"><img src="/docsproto/howto/assets/images/Delph-In.png" alt="DELPH-IN How-To"></a>
        
        <a class="site-title" href="/docsproto/howto/">
          DELPH-IN How-To
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/home/Home">Home</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/howto/DelphinWelcome">How-To</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/erg/ErgTop">ERG</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/tools/ToolsTop">Tools</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/grammars/GrammarsOverview">Grammars</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/matrix/MatrixDocsOverview">Matrix</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/summits/SummitTop">Summits</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/garage/GarageTop">Garage</a>
            </li><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/docsproto/missing/AclAnthologyCorpus">Missing</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">DELPH-IN</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/DelphinWelcome/">Welcome</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoOverview/">Overview</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoMRS/">Minimal Recursion Semantics</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoWellFormedTree/">Well-Formed Trees</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPredicationContract/">The Predication Contract</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPythonBasics/">Python Primer and State</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoImplementPredication/">Implementing a Predication</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoMRSToPython/">MRS To Python</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoConjunctions/">Conjunctions</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoScopalArguments/">Scopal Arguments</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoEvents/">Event Variables</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoHandlingEventInformation/">Handling Event Information</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSentenceForce/">Sentence Force</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimplePropositions/">Simple Propositions</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimpleQuestions/">Simple Questions</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimpleCommands/">Simple Commands</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoChoosingWhichFailure/">Reporting the Right Failure</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoReportingAFailure/">A Naive Failure</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoConceptualFailures/">Converting Variables to English</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoRobustFailure/">A More Robust Failure</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoQuantifierErrors/" class="active">Quantifier Errors</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoFinishingErrors/">Adding Errors to Every Predication</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoErrorScenarios/">Error Scenarios Summary</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoGenerateMRSAndTrees/">Phrases to MRS and Trees</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoWhichParseAndTree/">Choosing the 'Right' Tree</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoUnknownWords/">Unknown Words and Synonyms</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPredicationArgumentsAndUsage/">Predication Signatures and Usage</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoDiagnostics/">Diagnostics</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoSimpleTesting/">Testing</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoPythonDecorators/">A. Python Decorators</a></li>
          
            <li><a href="/docsproto/howto/devhowto/devhowtoParsePredication/">B. Parsing Predications</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">(early draft) Developer Predication Tutorial</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/devvocab/devvocabOverview/">Overview</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabPhrasesAndVocab/">Phrases and Vocabulary</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabLoc_nonspAndPlace/">loc_nonsp(e,x,x) and place(x)</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabCustomQueryAnswers/">Custom Query Answers</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabReorderingQuantifierArguments/">Reordering Quantifier Arguments</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabThis_q_dem/">this_q_dem(x,h,h)</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabThing/">thing(x)</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabIn_p_loc/">_in_p_loc(e,x,x)</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabFileDirectoryNames/">fw_seq(...) and quoted(c,i)</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabContextInHelpers/">Errors in Helper Functions</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabGoTo/">_go_v_1 and _to_p_dir</a></li>
          
            <li><a href="/docsproto/howto/devvocab/devvocabLocativePrepositions/">Locative Prepositions</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Grammarian Tutorial</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/DelphinTutorial/">Overview</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Formalisms/">Formalisms</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Grammars/">Grammars</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Processing/">Processing</a></li>
          
            <li><a href="/docsproto/howto/DelphinTutorial_Distributions/">Distributions</a></li>
          
            <li><a href="/docsproto/howto/HpsgTutorial/">HPSG</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Other Tutorials</span>
        

        
        <ul>
          
            <li><a href="/docsproto/howto/SaarlandAceAgree/">Ace/Agree Tutorial (2013)</a></li>
          
            <li><a href="/docsproto/howto/ErsTutorial/">English Resource Semantics Tutorial (NAACL 2016)</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h3 id="improving-quantifier-errors">Improving Quantifier Errors</h3>
<p>With the same approach to error reporting in <code class="language-plaintext highlighter-rouge">_file_n_of</code> that we did in <code class="language-plaintext highlighter-rouge">large_a_1</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, name="_file_n_of")
def file_n_of(state, x):
    
    ...
    
    for item in iterator:
        if isinstance(item, File):
            new_state = state.SetX(x, item)
            yield new_state
        else:
            ReportError(["xIsNotY", x, "file"])
</code></pre></div></div>

<p>… and evaluating “A file is large”:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          ┌────── _file_n_of(x3,i8)
_a_q(x3,RSTR,BODY)    
               └─ _large_a_1(e2,x3)
</code></pre></div></div>

<p>… against a world of <em>no</em> files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a dog
a folder
</code></pre></div></div>

<p>We got the response, “A thing is not a file”, which is a little <em>too</em> obtuse. Yes, maybe, the user <em>might</em> interpret that as “Nothing is a file” (which would be a fine error), but we can generate something better.</p>

<p>To understand how, we need to look at how the MRS is evaluated. Every variable in an MRS is “scoped” by exactly one quantifier – the quantifier that has the variable as its first argument. “Scoped” means that the only things that can reference that variable must be in the branches of the <code class="language-plaintext highlighter-rouge">RSTR</code> or <code class="language-plaintext highlighter-rouge">BODY</code> of that quantifier and nowhere else in the MRS.  The quantifier works like this:</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RSTR</code> scopal argument defines what is being quantified</li>
  <li>The quantifier itself specifies “how much” of the <code class="language-plaintext highlighter-rouge">RSTR</code> is being selected</li>
  <li>The <code class="language-plaintext highlighter-rouge">BODY</code> defines what is happening to the quantified items from the <code class="language-plaintext highlighter-rouge">RSTR</code></li>
</ul>

<p>For example, “A file is large” has the <code class="language-plaintext highlighter-rouge">_a_q</code> quantifier:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          ┌────── _file_n_of(x3,i8)
_a_q(x3,RSTR,BODY)    
               └─ _large_a_1(e2,x3)
</code></pre></div></div>
<p>… and this means: <code class="language-plaintext highlighter-rouge">_a_q</code> is true when “an arbitrary single item” (the quantification “a”) from the <code class="language-plaintext highlighter-rouge">RSTR</code> (<code class="language-plaintext highlighter-rouge">_file_n_of(x3,i8)</code>) is true when the <code class="language-plaintext highlighter-rouge">BODY</code> (<code class="language-plaintext highlighter-rouge">_large_a_1(e2,x3)</code>) is evaluated.</p>

<p>So, it turns out that the error we want to generate, “There aren’t any files”, could be generated by the <em>quantifier</em> if there is nothing in the <code class="language-plaintext highlighter-rouge">RSTR</code> to try on the <code class="language-plaintext highlighter-rouge">BODY</code>.</p>

<p>Said differently, quantifiers should always report an error like “There aren’t any ‘whatever the <code class="language-plaintext highlighter-rouge">RSTR</code> said’” if there aren’t any solutions to the <code class="language-plaintext highlighter-rouge">RSTR</code>. <em>That</em> is how we get the right error for this scenario.</p>

<p>Because our error system will always report the <em>deepest</em> error, and the error that comes from the <code class="language-plaintext highlighter-rouge">RSTR</code> will be deeper than the error from its quantifier, we’ll need to add a way to “force” an error in our <code class="language-plaintext highlighter-rouge">ReportError()</code> method, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def ReportError(self, error, force=False):
        if force or self._error_predication_index &lt; self._predication_index:
            self._error = error
            self._error_predication_index = self._predication_index
</code></pre></div></div>

<p>Then, we can modify the implementation of <code class="language-plaintext highlighter-rouge">a_q</code> to report a better error when the <code class="language-plaintext highlighter-rouge">RSTR</code> can’t be solved:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, name="_a_q")
def a_q(state, x_variable, h_rstr, h_body):
    # Run the RSTR which should fill in the variable with an item
    rstr_found = False
    for solution in Call(vocabulary, state, h_rstr):
        rstr_found = True

        # Now see if that solution works in the BODY
        body_found = False
        for body_solution in Call(vocabulary, solution, h_body):
            yield body_solution
            body_found = True

        if body_found:
            # If it works, stop looking. This one is the single arbitrary item we are looking for
            break

    if not rstr_found:
        # Ignore whatever error the RSTR produced, this is a better one
        ReportError(["doesntExist", x_variable], force=True)
        
       
def GenerateMessage(mrs, error_term):

    ...
    
    if error_constant == "doesntExist":
        arg1 = EnglishForDelphinVariable(error_constant, error_arguments[1], mrs)
        return f"There isn't {arg1} in the system"
        
    ...
    
# Evaluate the proposition: "a file is large" when there are no files, period
def Example11():
    state = State([Folder(name="Desktop"),
                   Folder(name="Documents")])

    mrs = {}
    mrs["Index"] = "e1"
    mrs["Variables"] = {"x1": {"NUM": "pl"},
                        "e1": {"SF": "prop"}}
    mrs["RELS"] = [["_a_q", "x1", ["_file_n_of", "x1"], ["_large_a_1", "e1", "x1"]]]

    state = state.SetX("mrs", mrs)
    DelphinContext().RespondToMRS(state, mrs)
    
# Prints:
There isn't a thing in the system
</code></pre></div></div>
<p>This is close, but it is saying “thing” instead of “file”. Recall that <code class="language-plaintext highlighter-rouge">EnglishForDelphinVariable()</code> converts variables to their English equivalents <em>at the point where the error happened</em>. Since <code class="language-plaintext highlighter-rouge">a_q</code> is reporting the error, the function thinks neither the <code class="language-plaintext highlighter-rouge">RSTR</code> or <code class="language-plaintext highlighter-rouge">BODY</code> has been evaluated yet. Thus <code class="language-plaintext highlighter-rouge">x</code> is only a “thing” at that point. We need a way for <code class="language-plaintext highlighter-rouge">a_q</code> to indicate that it wants what <code class="language-plaintext highlighter-rouge">x</code> will contain <em>after the <code class="language-plaintext highlighter-rouge">RSTR</code> is evaluated</em>.</p>

<p>We’ll do this by creating a function <code class="language-plaintext highlighter-rouge">IndexOfPredication()</code> that gives the index of any predication in an MRS. Then, instead of passing the variable itself in the error (<code class="language-plaintext highlighter-rouge">x1</code>), we’ll pass a special list that will tell <code class="language-plaintext highlighter-rouge">EnglishForDelphinVariable()</code> to use the variables value “as if it was evaluated at a different predication” like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ReportError(["doesntExist", ["AtPredication", h_body, x_variable]], force=True)
</code></pre></div></div>

<p>Here’s the code that does it all:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Returns the index of a predication in an MRS
def IndexOfPredication(mrs, stop_predication):
    current_predication_index = [1]

    def StopAtBranch(predication):
        if predication == stop_predication:
            # This is the predication we are looking for
            # Return the index of it
            return current_predication_index[0]
        else:
            current_predication_index[0] = current_predication_index[0] + 1

    return WalkTreeUntil(mrs["RELS"], StopAtBranch)
    
    
def EnglishForDelphinVariable(failure_index, variable, mrs):
    if isinstance(variable, list):
        if variable[0] == "AtPredication":
            failure_index = IndexOfPredication(mrs, variable[1])
            variable = variable[2]
            
    ...
    
    
@Predication(vocabulary, name="_a_q")
def a_q(state, x_variable, h_rstr, h_body):
    
    ...
    
    if not rstr_found:
        # Ignore whatever error the RSTR produced, this is a better one
        # Report the variable's English representation as it would be in the BODY
        ReportError(["doesntExist", ["AtPredication", h_body, x_variable]], force=True)
</code></pre></div></div>

<p>Now when we say “A file is large” in a world with no files we get “There isn’t a file in the system”. Much better!</p>

<blockquote>
  <p>Comprehensive source for the completed tutorial is available <a href="https://github.com/EricZinda/Perplexity">here</a>.</p>
</blockquote>

<p>Last update: 2023-01-06 by EricZinda [<a href="https://github.com/ericzinda/Perplexity/edit/main/docs/devhowto/devhowtoQuantifierErrors.md">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/docsproto/howto/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/docsproto/howto/assets/js/main.min.js"></script>




<script src="/docsproto/howto/assets/js/lunr/lunr.min.js"></script>
<script src="/docsproto/howto/assets/js/lunr/lunr-store.js"></script>
<script src="/docsproto/howto/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
